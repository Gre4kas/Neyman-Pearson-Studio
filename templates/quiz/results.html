{% extends "base.html" %}

{% block title %}Результаты теста: {{ quiz.title }}{% endblock %}

{% block content %}
<div class="text-center">
    <h1>Результаты теста «{{ quiz.title }}»</h1>
    <p class="lead">Вы ответили правильно на <strong>{{ correct_count }}</strong> из <strong>{{ total_questions }}</strong> вопросов.</p>
    <h2>Ваш результат: {{ score }}%</h2>
</div>
<hr>

{% for result in results %}
<div class="card mb-3 {% if result.is_correct %}border-success{% else %}border-danger{% endif %}">
    <div class="card-header {% if result.is_correct %}bg-success-subtle{% else %}bg-danger-subtle{% endif %}">
        <strong>Вопрос:</strong> {{ result.question.text }}
    </div>
    <div class="card-body">
        <h6>Ваш ответ(ы):</h6>
        <ul class="list-unstyled">
            {% for answer in result.user_answers %}
            <li>
                {% if answer in result.correct_answers %}
                <span class="badge bg-success me-1">✓</span>
                {% else %}
                <span class="badge bg-danger me-1">✗</span>
                {% endif %}
                {{ answer.text }}
            </li>
            {% empty %}
            <li><span class="badge bg-secondary">(ответ не дан)</span></li>
            {% endfor %}
        </ul>

        {% if not result.is_correct %}
        <h6 class="mt-3">Правильный ответ(ы):</h6>
        <ul class="list-unstyled">
            {% for answer in result.correct_answers %}
            <li>
                <span class="badge bg-success me-1">✓</span>
                {{ answer.text }}
            </li>
            {% endfor %}
        </ul>

        {% if result.question.explanation %}
        <div class="alert alert-info mt-2 mb-0">
            <strong>Пояснение:</strong> {{ result.question.explanation }}
        </div>
        {% endif %}
        {% endif %}
    </div>
</div>
{% endfor %}

<div class="text-center mt-4">
    <a href="{% url 'quiz:list' %}" class="btn btn-primary btn-lg">Выбрать другой тест</a>
    <a href="{% url 'home' %}" class="btn btn-secondary btn-lg">На главную</a>
</div>
{% endblock %}